<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div th:fragment="card-display (storage,storageName)">
    <!--/*@thymesVar id="formatter" type="org.chronopolis.ingest.support.FileSizeFormatter"*/-->
    <!--/*@thymesVar id="storage" type="org.chronopolis.rest.entities.storage.StagingStorage"*/-->
    <!--/*@thymesVar id="fixity" type="org.chronopolis.rest.entities.storage.Fixity"*/-->
    <div class="card-text p-2">

        <!-- list for showing storage/fixity/etc -->
        <div class="row">
            <div class="col-3">
                <div th:id="|v-tab-${storageName}|" class="nav flex-column nav-pills" role="tablist"
                     aria-orientation="vertical">

                    <a th:id="|v-storage-tab-${storageName}|" th:href="@{|#v-storage-${storageName}|}"
                       th:aria-controls="|v-storage-${storageName}|"
                       class="nav-link active" data-toggle="pill" role="tab" aria-selected="true">Storage</a>

                    <!-- for each fixity -->
                    <a th:each="fixity : ${storage.fixities}"
                       th:id="|v-${fixity.algorithm}-tag-${storageName}|"
                       th:href="@{|#v-${fixity.algorithm}-${storageName}|}"
                       th:aria-controls="|v-${fixity.algorithm}-${storageName}|" th:text="${fixity.algorithm}"
                       class="nav-link" data-toggle="pill" role="tab" aria-selected="false">
                    </a>

                    <a th:id="|v-add-fixity-tab-${storageName}|"
                       th:href="@{|${bag.id}/storage/${storage.id}/fixity|}"
                       th:aria-controls="|v-add-fixity-${storageName}|"
                       class="nav-link" data-toggle="pill" role="tab" aria-selected="false">Add Fixity</a>
                </div>
            </div>

            <!-- content to display -->
            <div class="col-9">
                <div class="tab-content" th:id="|v-content-${storageName}|">
                    <div class="tab-pane fade show active" th:id="|v-storage-${storageName}|" role="tabpanel"
                         th:aria-labelledby="|v-storage-tab-${storageName}|">
                        <ul class="list-group">
                            <div th:replace="fragments/storage :: list-item(head='Path', content=${storage.path})"></div>
                            <div th:replace="fragments/storage :: list-item(head='Files', content=${storage.totalFiles})"></div>
                            <div th:replace="fragments/storage :: list-item(head='Size', content=${formatter.format(storage.size)})"></div>
                            <!-- inactive + modal -->
                            <!-- can see about making this a fragment as well -->
                            <li class="w-100" style="display: block; border: 1px solid rgba(0,0,0,.125)">
                                <button data-toggle="modal" th:data-target="|#${storageName}-remove|"
                                        class="btn btn-danger col-2" style="border-radius: 0">Set Inactive
                                </button>

                                <div class="modal fade" th:id="|${storageName}-remove|" tabindex="-1" role="dialog">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                Warning: Proceeding will remove the active storage object.
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                    Close
                                                </button>
                                                <a th:href="@{|${bag.id}/storage/${storage.id}/activate|}"
                                                   type="submit" class="btn btn-danger">Set Inactive
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div th:each="fixity: ${storage.fixities}" class="tab-pane fade"
                         th:id="|v-${fixity.algorithm}-${storageName}|" role="tabpanel"
                         th:aria-labelledby="|v-${fixity.algorithm}-tab-${storageName}|">
                        <ul class="list-group">
                            <div th:replace="fragments/storage :: list-item(head='Value', content=${fixity.value})"></div>
                            <div th:replace="fragments/storage :: list-item(head='Created', content=${fixity.createdAt})"></div>
                            <!-- remove + modal -->
                            <li class="w-100" style="display: block; border: 1px solid rgba(0,0,0,.125)">
                                <button data-toggle="modal"
                                        th:data-target="|#${fixity.algorithm}-${storageName}-remove|"
                                        class="btn btn-danger col-2" style="border-radius: 0">Remove
                                </button>
                            </li>

                            <div class="modal fade" th:id="|${fixity.algorithm}-${storageName}-remove|" tabindex="-1"
                                 role="dialog">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-body">
                                            Warning: Proceeding will remove the fixity object.
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close
                                            </button>
                                            <a th:href="@{|${bag.id}/storage/${storage.id}/fixity/${fixity.id}|}"
                                               class="btn btn-danger">Remove Fixity
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<li th:fragment="list-item (head, content)" class="w-100"
    style="display: block; border: 1px solid rgba(0,0,0,.125)">
    <button type="button" class="btn btn-secondary float-left col-2"
            style="border-radius: 0; border-right: 1px solid rgba(0,0,0,0.125)" th:text="${head}">
    </button>
    <!-- todo: something other than button -->
    <button type="button" class="btn btn-light text-left col-10" style="border-radius: 0"
            th:text="${content}"></button>
</li>
</html>
