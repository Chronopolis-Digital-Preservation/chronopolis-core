<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en">
    <meta charset="UTF-8"/>
    <title></title>
</head>
<body>
<div class="card w-75 filterable" th:fragment="simple-table">
    <nav aria-label="breadcrumb" role="naviation">
        <ol class="breadcrumb" style="margin-bottom: 0 !important;">
            <li class="breadcrumb-item"><a th:href="@{/bags/overview}">Bags Overview</a></li>
            <li class="breadcrumb-item active">List Bags</li>

            <a data-toggle="collapse" data-target="#filter-body" id="dropdown" class="ml-auto"
               style="padding: 0 !important" aria-expanded="false" aria-controls="filter-body">
                <i class="fa fa-search"></i> Search
            </a>
        </ol>

        <div id="filter-body" class="collapse p-2">
            <form th:action="@{/bags}" method="GET">
                <div class="form-group row">
                    <label for="depositor-table-filter" class="col-form-label col-2">Depositor</label>
                    <input class="form-control col-9" id="depositor-table-filter" name="depositor"
                           placeholder="Search Depositor"/>
                </div>
                <div class="form-group row">
                    <label for="name-table-filter" class="col-form-label col-2">Bag Name</label>
                    <input class="form-control col-9" id="name-table-filter" name="name"
                           placeholder="Search Name"/>
                </div>
                <div class="form-group row">
                    <label for="status-table-filter" class="col-form-label col-2">Status</label>
                    <select multiple="multiple" name="status" id="status-table-filter" class="form-control col-9">
                        <!--/*@thymesVar id="statuses" type="com.google.common.collect.ImmutableListMultimap<String, BagStatus>"*/-->
                        <optgroup th:each="group : ${statuses.keySet()}" th:label="${group}">
                            <option th:each="status : ${statuses.get(group)}" th:value="${status}"
                                    th:text="${status}"></option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group row">
                    <label class="col-form-label col-2" for="direction-filter">Order By</label>
                    <div class="form-check col-2 align-self-center">
                        <label class="form-check-label">
                            <input class="form-check-input" type="radio" name="orderBy" id="optionUpdatedAt"
                                   value="updatedAt"/> Updated At
                        </label>
                    </div>
                    <div class="form-check col-2 align-self-center">
                        <label class="form-check-label">
                            <input class="form-check-input" type="radio" name="orderBy" id="optionCreatedAt"
                                   value="createdAt"/> Created At
                        </label>
                    </div>
                    <div class="col-3">
                        <select name="dir" id="direction-filter" class="form-control">
                            <option value="ASC">Ascending</option>
                            <option value="DESC">Descending</option>
                        </select>
                    </div>
                </div>
                <button th:type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </nav>

    <table class="table table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>Depositor</th>
            <th>Name</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Updated At</th>
            <!--
            <th>Created At<a th:href="@{/bags(sort='created_at')}" th:method="POST"><i class="fa fa-sort fa-fw" aria-hidden="true"></i></a></th>
            <th>Updated At<a th:href="@{/bags(sort='updated_at')}" th:method="POST"><i class="fa fa-sort fa-fw" aria-hidden="true"></i></a></th>
            -->
        </tr>
        </thead>
        <tbody>
        <!--@thymesVar id="bags" type="Page<Bag>"-->
        <!--@thymesVar id="bag" type="org.chronopolis.rest.entities.Bag"-->
        <tr th:each="bag: ${bags}" th:attr="data-href=@{|/bags/${bag.id}|}" class="table-clickable">
            <td th:text="${bag.id}"></td>
            <td th:text="${bag.depositor}"></td>
            <td th:text="${bag.name}"></td>
            <td th:text="${bag.status}"></td>
            <td th:text="${bag.createdAt.toLocalDate()}"></td>
            <td th:text="${bag.updatedAt.toLocalDate()}"></td>
        </tr>
        </tbody>
    </table>

    <div th:replace="fragments/page :: page"></div>
</div>

<!-- This is typically only for an individual bag, as getting the token count
     can be a long operation over multiple bags

     Might put the Associated repls in a tab or smth
     -->
<div class="card w-75" th:fragment="info">
    <nav aria-label="breadcrumb" role="navigation">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/bags}">Bags</a></li>
            <li class="breadcrumb-item"><a th:href="@{/bags(depositor=${bag.depositor})}" th:text="${bag.depositor}">Depositor</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page" th:text="${bag.name}">Bag Name</li>
        </ol>
    </nav>

    <!--@thymesVar id="tokens" type="Long"-->
    <!--@thymesVar id="bag" type="org.chronopolis.rest.entities.Bag"-->
    <div class="card-body p-2">
        <table class="c-table">
            <div th:replace="fragments/storage :: list-item(head='Id', content=${bag.id})"></div>
            <div th:replace="fragments/storage :: list-item(head='Num Tokens', content=${tokens})"></div>
            <div th:replace="fragments/storage :: list-item(head='Status', content=${bag.status})"></div>
            <div th:replace="fragments/storage :: list-item(head='Created By', content=${bag.creator})"></div>
            <div th:replace="fragments/storage :: list-item(head='Created At', content=${bag.createdAt})"></div>
            <div th:replace="fragments/storage :: list-item(head='Updated At', content=${bag.updatedAt})"></div>
        </table>
    </div>

    <div class="card-header" data-toggle="collapse" href="#stagingCollapse"
         aria-expanded="false" aria-controls="stagingCollapse">
        <h4>Active Staging</h4>
    </div>
    <div class="collapse" id="stagingCollapse">
        <!--/*@thymesVar id="bag" type="org.chronopolis.rest.entities.Bag"*/-->
        <!--/*@thymesVar id="activeBagStorage" type="org.chronopolis.rest.entities.storage.StagingStorage"*/-->
        <!--/*@thymesVar id="activeTokenStorage" type="org.chronopolis.rest.entities.storage.StagingStorage"*/-->
        <!-- add pill for link to all? -->
        <div class="card-body p-2">
            <div class="hr-sect mx-auto">Bag Staging</div>
            <th:block th:if="${activeBagStorage} != null">
                <div th:replace="fragments/storage :: card-display (storage=${activeBagStorage},storageName='bag',rw=true)"></div>
            </th:block>
            <th:block th:if="${activeBagStorage} == null">
                <div class="btn-group p-2" role="group">
                    <a class="btn btn-outline-primary"
                       th:href="@{|${bag.id}/storage/add|}">
                        Add Bag Staging
                    </a>
                </div>
            </th:block>
            <div class="hr-sect mx-auto">Token Staging</div>
            <th:block th:if="${activeTokenStorage} != null">
                <div th:replace="fragments/storage :: card-display (storage=${activeTokenStorage},storageName='token',rw=true)"></div>
            </th:block>
            <th:block th:if="${activeTokenStorage} == null">
                <div class="btn-group p-2" role="group">
                    <a class="btn btn-outline-primary"
                       th:href="@{|${bag.id}/storage/add|}">
                        Write Tokens
                    </a>
                </div>
            </th:block>

            <div class="btn-group p-2" role="group">
                <a class="btn btn-primary" th:href="@{|${bag.id}/storage/all|}">See Inactive Staging</a>
            </div>
        </div>
    </div>

    <div class="card-header">
        <h4>Associated Replications</h4>
    </div>
    <div class="card-body p-2">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>ID</th>
                <th>Node</th>
                <th>Status</th>
            </tr>
            </thead>
            <!--/*@thymesVar id="replications" type="List<Replication>"*/-->
            <!--/*@thymesVar id="repl" type="org.chronopolis.rest.entities.Replication"*/-->
            <tbody>
            <tr th:each="repl : ${replications}">
                <td><a th:text="${repl.id}" th:href="@{|/replications/${repl.id}|}"></a></td>
                <td th:text="${repl.node.username}"></td>
                <td th:text="${repl.status}"></td>
            </tr>
            </tbody>
        </table>
        <a class="btn btn-primary" th:href="@{/replications/create(bag=${bag.id})}">Create Replication</a>
    </div>
</div>
</body>
</html>
